console.log(' Script loaded - Initializing all functionality');const adminSecretEncoded='aGFpbGlmdTIwMjY=';const adminUnlockStorageKey='hailifu_admin_unlocked';let adminPanel=null;let adminToggle=null;let adminTabs=[];let adminTabPanels=[];let reviewsRequireApproval=null;let pendingReviewsGrid=null;let approvedReviewsGrid=null;let overviewTotalLeads=null;let overviewRecentReviews=null;let overviewReach=null;let overviewLeadsList=null;let interestCctv=null;let interestElectrical=null;let interestGates=null;let interestAirconditioning=null;let interestCctvCount=null;let interestElectricalCount=null;let interestGatesCount=null;let interestAirconditioningCount=null;let leadsGrid=null;let projectsGrid=null;let uploadBtn=null;let projectTitle=null;let projectCategory=null;let projectDescription=null;let projectFile=null;let fileUploadArea=null;let mediaTypeButtons=[];let selectedMediaType='image';let adminBindingsReady=false;document.addEventListener('contextmenu',(event)=>{event.preventDefault();});document.addEventListener('keydown',(event)=>{if(event.key==='F12'||event.keyCode===123){event.preventDefault();}});setInterval(()=>{console.clear();console.warn('Property of Hailifu Brilliant Installation. Unauthorized access prohibited.');console.info('System Optimized - Hailifu V2.0');},1200);function readJsonStorage(key,fallback){try{const raw=localStorage.getItem(key);if(!raw)return fallback;return JSON.parse(raw);}catch{return fallback;}}
function writeJsonStorage(key,value){localStorage.setItem(key,JSON.stringify(value));}
const reviewForm=document.getElementById('reviewForm');const formSuccess=document.getElementById('formSuccess');const reviewModal=document.getElementById('reviewModal');const reviewModalClose=document.getElementById('reviewModalClose');const heroQuoteBtn=document.getElementById('heroQuoteBtn');const heroVideo=document.getElementById('heroVideo');const heroFallbackImage=document.getElementById('heroFallbackImage');const heroVideoLazyLoad=()=>{if(!heroVideo||heroVideo.dataset.loaded==='1')return;const src=heroVideo.dataset.src;if(!src)return;heroVideo.setAttribute('src',src);heroVideo.dataset.loaded='1';};if(heroVideo){['pointerdown','touchstart','scroll'].forEach((eventName)=>{window.addEventListener(eventName,heroVideoLazyLoad,{once:true,passive:true});});window.addEventListener('keydown',heroVideoLazyLoad,{once:true});}
const publicReviewsGrid=document.getElementById('publicReviewsGrid');const navEl=document.getElementById('nav');const mobileToggle=document.getElementById('mobileToggle');const headerLogo=document.getElementById('headerLogo');const adminTrigger=document.getElementById('admin-trigger')||headerLogo;const adminLogoLink=headerLogo||adminTrigger?.closest('a');if(mobileToggle&&navEl){mobileToggle.addEventListener('click',()=>{navEl.classList.toggle('active');mobileToggle.classList.toggle('active',navEl.classList.contains('active'));});navEl.querySelectorAll('a').forEach((a)=>{a.addEventListener('click',()=>{navEl.classList.remove('active');mobileToggle.classList.remove('active');});});}
function getReviewSettings(){const stored=readJsonStorage('hailifu_review_settings',null);if(stored&&typeof stored.requireApproval==='boolean'){return stored;}
return{requireApproval:true};}
function saveReviewSettings(settings){writeJsonStorage('hailifu_review_settings',settings);}
function getReviews(){return readJsonStorage('hailifu_reviews',[]);}
function saveReviews(reviews){writeJsonStorage('hailifu_reviews',reviews);}
function ratingStars(rating){const r=Math.max(1,Math.min(5,Number(rating)||0));return'★'.repeat(r)+'☆'.repeat(5-r);}
function notifyAdminReviewSubmitted(review){try{alert('New review submitted on your website!');}catch{}
const msg=`New website review submitted:%0AName: ${encodeURIComponent(review.name || '')}%0ARating: ${encodeURIComponent(String(review.rating || ''))}%0AComment: ${encodeURIComponent(review.comment || '')}`;const waUrl=`https://wa.me/233550997255?text=${msg}`;try{if(confirm('Open WhatsApp to notify admin (0550997255)?')){window.open(waUrl,'_blank');}}catch{}}
function renderPublicReviews(){if(!publicReviewsGrid)return;publicReviewsGrid.querySelectorAll('[data-user-review="1"]').forEach((n)=>n.remove());const approved=getReviews().filter((r)=>r.status==='approved');approved.slice(0,12).reverse().forEach((r)=>{const card=document.createElement('article');card.className='hailifu-review-card';card.dataset.userReview='1';card.dataset.reviewId=r.id;const safeName=String(r.name||'Customer').replace(/</g,'&lt;').replace(/>/g,'&gt;');const safeComment=String(r.comment||'').replace(/</g,'&lt;').replace(/>/g,'&gt;');card.innerHTML=`
                    <div class="hailifu-review-card-header">
                        <span class="hailifu-reviewer">${safeName}</span>
                        <span class="hailifu-review-score">${ratingStars(r.rating)}</span>
                    </div>
                    <p>"${safeComment}"</p>
                `;publicReviewsGrid.insertBefore(card,publicReviewsGrid.firstChild);});}
function renderAdminReviews(){const reviews=getReviews();if(pendingReviewsGrid){const pending=reviews.filter((r)=>r.status==='pending');pendingReviewsGrid.innerHTML=pending.length?pending.map((r)=>{const when=r.createdAt?new Date(r.createdAt).toLocaleString():'';const safeName=String(r.name||'Customer').replace(/</g,'&lt;').replace(/>/g,'&gt;');const safeComment=String(r.comment||'').replace(/</g,'&lt;').replace(/>/g,'&gt;');return`
                            <div class="lead-card" data-review-row="1" data-review-id="${r.id}">
                                <strong>${safeName}</strong>
                                <small>${when}</small>
                                <div style="margin-top:10px; line-height:1.5;">${ratingStars(r.rating)}<br>"${safeComment}"</div>
                                <div class="review-admin-actions">
                                    <button class="review-admin-btn approve" type="button" data-review-approve="${r.id}">Approve</button>
                                    <button class="review-admin-btn delete" type="button" data-review-delete="${r.id}">Delete</button>
                                </div>
                            </div>
                        `;}).join(''):'<div class="lead-card"><strong>No pending reviews</strong><small>New reviews will appear here for approval.</small></div>';}
if(approvedReviewsGrid){const approved=reviews.filter((r)=>r.status==='approved');approvedReviewsGrid.innerHTML=approved.length?approved.map((r)=>{const when=r.createdAt?new Date(r.createdAt).toLocaleString():'';const safeName=String(r.name||'Customer').replace(/</g,'&lt;').replace(/>/g,'&gt;');const safeComment=String(r.comment||'').replace(/</g,'&lt;').replace(/>/g,'&gt;');return`
                            <div class="lead-card" data-review-row="1" data-review-id="${r.id}">
                                <strong>${safeName}</strong>
                                <small>${when}</small>
                                <div style="margin-top:10px; line-height:1.5;">${ratingStars(r.rating)}<br>"${safeComment}"</div>
                                <div class="review-admin-actions">
                                    <button class="review-admin-btn delete" type="button" data-review-delete="${r.id}">Delete</button>
                                </div>
                            </div>
                        `;}).join(''):'<div class="lead-card"><strong>No approved reviews</strong><small>Approve reviews to show them publicly.</small></div>';}}
function getServiceInterest(){const raw=readJsonStorage('hailifu_service_interest',null);const base={cctv:0,electrical:0,airconditioning:0,gates:0,blindcurtain:0};if(!raw||typeof raw!=='object')return base;return{...base,cctv:Number(raw.cctv)||0,electrical:Number(raw.electrical)||0,airconditioning:Number(raw.airconditioning)||0,gates:Number(raw.gates)||0,blindcurtain:Number(raw.blindcurtain)||0};}
function saveServiceInterest(data){writeJsonStorage('hailifu_service_interest',data);}
function bumpServiceInterest(serviceKey){if(!serviceKey)return;const interest=getServiceInterest();if(typeof interest[serviceKey]!=='number')return;interest[serviceKey]+=1;saveServiceInterest(interest);refreshOverview();}
function bumpPageLoads(){const current=Number(localStorage.getItem('hailifu_page_loads')||'0')||0;const next=current+1;localStorage.setItem('hailifu_page_loads',String(next));return next;}
function refreshOverview(){const leads=readJsonStorage('hailifu_leads',[]);const reviews=getReviews();if(overviewTotalLeads)overviewTotalLeads.textContent=String(leads.length);if(overviewRecentReviews)overviewRecentReviews.textContent=String(reviews.length);if(overviewReach)overviewReach.textContent=String(Number(localStorage.getItem('hailifu_page_loads')||'0')||0);const interest=getServiceInterest();const max=Math.max(interest.cctv,interest.electrical,interest.airconditioning,interest.gates,interest.blindcurtain,1);if(interestCctv)interestCctv.style.width=`${Math.round((interest.cctv / max) * 100)}%`;if(interestElectrical)interestElectrical.style.width=`${Math.round((interest.electrical / max) * 100)}%`;if(interestAirconditioning)interestAirconditioning.style.width=`${Math.round((interest.airconditioning / max) * 100)}%`;if(interestGates)interestGates.style.width=`${Math.round((interest.gates / max) * 100)}%`;if(interestCctvCount)interestCctvCount.textContent=String(interest.cctv);if(interestElectricalCount)interestElectricalCount.textContent=String(interest.electrical);if(interestAirconditioningCount)interestAirconditioningCount.textContent=String(interest.airconditioning);if(interestGatesCount)interestGatesCount.textContent=String(interest.gates);if(overviewLeadsList){if(!leads||leads.length===0){overviewLeadsList.innerHTML='<div class="admin-lead-row"><strong>No leads yet</strong><small>Chatbot leads will appear here.</small></div>';}else{overviewLeadsList.innerHTML=leads.slice(0,20).map((l)=>{const service=l.serviceLabel||l.service||'Lead';const name=l.name||'';const phone=l.phone||'';const when=l.createdAt?new Date(l.createdAt).toLocaleString():'';return`
                            <div class="admin-lead-row">
                                <strong>${service}</strong>
                                <small>${when}<br>Name: ${name}<br>Phone: ${phone}</small>
                            </div>
                        `;}).join('');}}}
function setAdminTab(key){adminTabs.forEach((t)=>t.classList.toggle('active',t.dataset.adminTab===key));adminTabPanels.forEach((p)=>p.classList.toggle('active',p.dataset.adminPanel===key));if(key==='overview')refreshOverview();if(key==='reviews'){renderAdminReviews();renderPublicReviews();refreshOverview();}}
if(reviewForm){console.log(' Review form found');reviewForm.addEventListener('submit',function(e){e.preventDefault();console.log(' Review form submitted');const formData=new FormData(reviewForm);const name=String(formData.get('name')||'').trim();const rating=Number(formData.get('rating')||0);const comment=String(formData.get('comment')||'').trim();if(!name||!rating||!comment){alert('Please fill in your Name, Rating, and Review.');return;}
const settings=getReviewSettings();const successMessage=settings.requireApproval?'Thanks! Your review was received and will appear after approval.':'Thank you for your review! We appreciate your feedback.';const review={id:`r_${Date.now()}`,createdAt:new Date().toISOString(),name,rating,comment,status:settings.requireApproval?'pending':'approved'};const reviews=getReviews();reviews.unshift(review);saveReviews(reviews);renderAdminReviews();renderPublicReviews();refreshOverview();notifyAdminReviewSubmitted(review);if(formSuccess){formSuccess.textContent=successMessage;formSuccess.style.display='block';setTimeout(()=>{formSuccess.style.display='none';closeReviewModal();},5000);}else{closeReviewModal();}
reviewForm.reset();});}else{console.error(' Review form not found');}
function openReviewModal(){if(!reviewModal)return;if(formSuccess)formSuccess.style.display='none';if(reviewForm)reviewForm.reset();reviewModal.classList.add('active');reviewModal.setAttribute('aria-hidden','false');document.body.classList.add('modal-open');const nameInput=document.getElementById('reviewerName');if(nameInput)nameInput.focus();}
function closeReviewModal(){if(!reviewModal)return;reviewModal.classList.remove('active');reviewModal.setAttribute('aria-hidden','true');document.body.classList.remove('modal-open');}
document.addEventListener('click',(e)=>{const opener=e.target.closest('[data-review-modal-open]');if(!opener)return;e.preventDefault();openReviewModal();});if(reviewModalClose){reviewModalClose.addEventListener('click',closeReviewModal);}
if(reviewModal){reviewModal.addEventListener('click',(e)=>{if(e.target===reviewModal)closeReviewModal();});}
document.addEventListener('keydown',(e)=>{if(e.key==='Escape'){closeReviewModal();}});const chatbotToggle=document.getElementById('chatbotToggle');const chatbotContainer=document.getElementById('chatbotContainer');const chatbotClose=document.getElementById('chatbotClose');const chatbotMessages=document.getElementById('chatbotMessages');const chatInput=document.getElementById('chatInput');const chatSendBtn=document.getElementById('chatSendBtn');const typingIndicator=document.getElementById('typingIndicator');const adminKnockWindowMs=3000;const adminKnockCount=5;const adminClickDelayMs=600;let adminKnocks=[];let adminKnockTimer=null;function decodeAdminSecret(){try{return atob(adminSecretEncoded||'');}catch{return'';}}
function isAdminUnlocked(){try{return sessionStorage.getItem(adminUnlockStorageKey)==='1';}catch{return false;}}
function setAdminUnlocked(){try{sessionStorage.setItem(adminUnlockStorageKey,'1');}catch{}}
function seedOpsLayer(){if(adminPanel)return adminPanel;const existing=document.getElementById('adminPanel');if(existing){adminPanel=existing;return adminPanel;}
const markup=`
                <div class="admin-panel" id="adminPanel" aria-hidden="true">
                    <div class="admin-header">
                        <h2><i class="fas fa-shield-alt"></i> Admin Command</h2>
                        <button class="admin-toggle" id="adminToggle" type="button" aria-label="Close admin panel">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="admin-content">
                        <div class="admin-tabs">
                            <button class="admin-tab active" type="button" data-admin-tab="overview">Overview</button>
                            <button class="admin-tab" type="button" data-admin-tab="leads">Leads</button>
                            <button class="admin-tab" type="button" data-admin-tab="projects">Projects</button>
                            <button class="admin-tab" type="button" data-admin-tab="reviews">Reviews</button>
                        </div>
                        <div class="admin-tab-panel active" data-admin-panel="overview">
                            <div class="command-stats">
                                <div class="command-stat-card new">
                                    <div class="command-stat-label">Total Leads</div>
                                    <div class="command-stat-value" id="overviewTotalLeads">0</div>
                                </div>
                                <div class="command-stat-card">
                                    <div class="command-stat-label">Reviews</div>
                                    <div class="command-stat-value" id="overviewRecentReviews">0</div>
                                </div>
                                <div class="command-stat-card success">
                                    <div class="command-stat-label">Page Reach</div>
                                    <div class="command-stat-value" id="overviewReach">0</div>
                                </div>
                            </div>
                            <div class="admin-section">
                                <h3><i class="fas fa-chart-line"></i> Service Interest</h3>
                                <div class="interest-row">
                                    <span>CCTV</span>
                                    <div class="interest-bar"><div class="interest-fill" id="interestCctv"></div></div>
                                    <strong id="interestCctvCount">0</strong>
                                </div>
                                <div class="interest-row">
                                    <span>Electrical</span>
                                    <div class="interest-bar"><div class="interest-fill" id="interestElectrical"></div></div>
                                    <strong id="interestElectricalCount">0</strong>
                                </div>
                                <div class="interest-row">
                                    <span>Air Conditioning</span>
                                    <div class="interest-bar"><div class="interest-fill" id="interestAirconditioning"></div></div>
                                    <strong id="interestAirconditioningCount">0</strong>
                                </div>
                                <div class="interest-row">
                                    <span>Automated Gates</span>
                                    <div class="interest-bar"><div class="interest-fill" id="interestGates"></div></div>
                                    <strong id="interestGatesCount">0</strong>
                                </div>
                            </div>
                            <div class="admin-section">
                                <h3><i class="fas fa-user-clock"></i> Recent Leads</h3>
                                <div id="overviewLeadsList"></div>
                            </div>
                        </div>
                        <div class="admin-tab-panel" data-admin-panel="leads">
                            <div class="admin-section">
                                <h3><i class="fas fa-id-card"></i> Lead Inbox</h3>
                                <div id="leadsGrid"></div>
                            </div>
                        </div>
                        <div class="admin-tab-panel" data-admin-panel="projects">
                            <div class="admin-section">
                                <h3><i class="fas fa-photo-video"></i> Upload Project</h3>
                                <form class="upload-form">
                                    <div class="form-group">
                                        <label for="projectTitle">Project Title</label>
                                        <input id="projectTitle" type="text" placeholder="Project name">
                                    </div>
                                    <div class="form-group">
                                        <label for="projectCategory">Category</label>
                                        <select id="projectCategory">
                                            <option value="cctv">CCTV</option>
                                            <option value="electrical">Electrical</option>
                                            <option value="airconditioning">Air Conditioning</option>
                                            <option value="gates">Automated Gates</option>
                                            <option value="fencing">Electric Fencing</option>
                                            <option value="smarthome">Smart Home</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="projectDescription">Description</label>
                                        <textarea id="projectDescription" placeholder="Short summary"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>Media Type</label>
                                        <div class="media-type-toggle">
                                            <button class="media-btn active" type="button" data-type="image"><i class="fas fa-image"></i> Image</button>
                                            <button class="media-btn" type="button" data-type="video"><i class="fas fa-video"></i> Video</button>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Upload Media</label>
                                        <div class="file-upload-area" id="fileUploadArea">
                                            <div class="upload-content">
                                                <i class="fas fa-cloud-upload-alt"></i>
                                                <p>Click or drop a file here</p>
                                                <span class="file-types">PNG, JPG, MP4 (max 4MB)</span>
                                            </div>
                                            <input id="projectFile" type="file" accept="image/*,video/*" style="display:none;">
                                        </div>
                                    </div>
                                    <button class="upload-btn" id="uploadBtn" type="button"><i class="fas fa-upload"></i> Save Project</button>
                                </form>
                            </div>
                            <div class="admin-section">
                                <h3><i class="fas fa-layer-group"></i> Stored Projects</h3>
                                <div id="projectsGrid" class="projects-grid"></div>
                            </div>
                        </div>
                        <div class="admin-tab-panel" data-admin-panel="reviews">
                            <div class="admin-section">
                                <h3><i class="fas fa-sliders-h"></i> Review Settings</h3>
                                <label style="display:flex; align-items:center; gap:10px; color: rgba(255,255,255,0.85);">
                                    <input type="checkbox" id="reviewsRequireApproval">
                                    Require approval before reviews appear publicly.
                                </label>
                            </div>
                            <div class="admin-section">
                                <h3><i class="fas fa-hourglass-half"></i> Pending Reviews</h3>
                                <div id="pendingReviewsGrid"></div>
                            </div>
                            <div class="admin-section">
                                <h3><i class="fas fa-check-circle"></i> Approved Reviews</h3>
                                <div id="approvedReviewsGrid"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;document.body.insertAdjacentHTML('beforeend',markup);adminPanel=document.getElementById('adminPanel');return adminPanel;}
function syncOpsNodes(){if(!adminPanel||adminBindingsReady)return;adminBindingsReady=true;adminToggle=document.getElementById('adminToggle');adminTabs=Array.from(document.querySelectorAll('.admin-tab'));adminTabPanels=Array.from(document.querySelectorAll('.admin-tab-panel'));reviewsRequireApproval=document.getElementById('reviewsRequireApproval');pendingReviewsGrid=document.getElementById('pendingReviewsGrid');approvedReviewsGrid=document.getElementById('approvedReviewsGrid');overviewTotalLeads=document.getElementById('overviewTotalLeads');overviewRecentReviews=document.getElementById('overviewRecentReviews');overviewReach=document.getElementById('overviewReach');overviewLeadsList=document.getElementById('overviewLeadsList');interestCctv=document.getElementById('interestCctv');interestElectrical=document.getElementById('interestElectrical');interestGates=document.getElementById('interestGates');interestAirconditioning=document.getElementById('interestAirconditioning');interestCctvCount=document.getElementById('interestCctvCount');interestElectricalCount=document.getElementById('interestElectricalCount');interestGatesCount=document.getElementById('interestGatesCount');interestAirconditioningCount=document.getElementById('interestAirconditioningCount');leadsGrid=document.getElementById('leadsGrid');projectsGrid=document.getElementById('projectsGrid');uploadBtn=document.getElementById('uploadBtn');projectTitle=document.getElementById('projectTitle');projectCategory=document.getElementById('projectCategory');projectDescription=document.getElementById('projectDescription');projectFile=document.getElementById('projectFile');fileUploadArea=document.getElementById('fileUploadArea');mediaTypeButtons=Array.from(document.querySelectorAll('.media-btn'));if(adminToggle){adminToggle.addEventListener('click',haltDataSync);}
adminTabs.forEach((tab)=>{tab.addEventListener('click',()=>{setAdminTab(tab.dataset.adminTab);});});if(reviewsRequireApproval){const settings=getReviewSettings();reviewsRequireApproval.checked=!!settings.requireApproval;reviewsRequireApproval.addEventListener('change',()=>{saveReviewSettings({requireApproval:!!reviewsRequireApproval.checked});});}
mediaTypeButtons.forEach((btn)=>{btn.addEventListener('click',(e)=>{e.preventDefault();mediaTypeButtons.forEach((b)=>b.classList.remove('active'));btn.classList.add('active');selectedMediaType=btn.dataset.type||'image';});});if(fileUploadArea&&projectFile){fileUploadArea.addEventListener('click',()=>projectFile.click());fileUploadArea.addEventListener('dragover',(e)=>{e.preventDefault();fileUploadArea.classList.add('dragover');});fileUploadArea.addEventListener('dragleave',()=>fileUploadArea.classList.remove('dragover'));fileUploadArea.addEventListener('drop',(e)=>{e.preventDefault();fileUploadArea.classList.remove('dragover');if(e.dataTransfer?.files?.[0]){projectFile.files=e.dataTransfer.files;}});}
if(uploadBtn){uploadBtn.addEventListener('click',(e)=>{e.preventDefault();const file=projectFile?.files?.[0];if(!file){alert('Please choose a file first.');return;}
if(file.size>4*1024*1024){alert('File is too large to save in browser storage. Please use a smaller file (under 4MB).');return;}
const reader=new FileReader();reader.onload=()=>{const id=`p_${Date.now()}`;const project={id,createdAt:new Date().toISOString(),title:projectTitle?.value||'Project',category:projectCategory?.value||'cctv',description:projectDescription?.value||'',mediaType:selectedMediaType,mediaSrc:String(reader.result||'')};const projects=getProjects();projects.unshift(project);saveProjects(projects);renderProjects();hydrateShowcaseFromStoredProjects();if(projectTitle)projectTitle.value='';if(projectDescription)projectDescription.value='';if(projectFile)projectFile.value='';};reader.readAsDataURL(file);});}
if(projectsGrid){projectsGrid.addEventListener('click',(e)=>{const deleteBtn=e.target.closest('[data-delete-project-id]');if(deleteBtn){const id=deleteBtn.getAttribute('data-delete-project-id');const projects=getProjects().filter((p)=>p.id!==id);saveProjects(projects);renderProjects();const generated=document.querySelector(`[data-generated-project-id="${id}"]`);if(generated)generated.remove();return;}
const thumb=e.target.closest('[data-admin-project-id]');if(!thumb)return;const id=thumb.getAttribute('data-admin-project-id');const project=getProjects().find((p)=>p.id===id);if(!project)return;const temp=document.createElement('div');temp.dataset.mediaSrc=project.mediaSrc;temp.dataset.mediaType=project.mediaType;temp.innerHTML=`
                        <div class="project-category">${project.category || ''}</div>
                        <div class="showcase-overlay">
                            <h3 class="showcase-title">${project.title || 'Project'}</h3>
                            <p class="showcase-description">${project.description || ''}</p>
                        </div>
                    `;openProjectModalFromItem(temp);});}
if(adminPanel){adminPanel.addEventListener('click',(e)=>{const approveBtn=e.target.closest('[data-review-approve]');if(approveBtn){const id=approveBtn.getAttribute('data-review-approve');const reviews=getReviews();const idx=reviews.findIndex((r)=>r.id===id);if(idx>=0){reviews[idx].status='approved';saveReviews(reviews);renderAdminReviews();renderPublicReviews();refreshOverview();}
return;}
const deleteBtn=e.target.closest('[data-review-delete]');if(deleteBtn){const id=deleteBtn.getAttribute('data-review-delete');const reviews=getReviews().filter((r)=>r.id!==id);saveReviews(reviews);renderAdminReviews();renderPublicReviews();refreshOverview();}});}}
function initDataSync(){seedOpsLayer();syncOpsNodes();if(adminPanel){adminPanel.classList.add('active');adminPanel.setAttribute('aria-hidden','false');}
setAdminTab('overview');renderLeads();renderProjects();renderAdminReviews();refreshOverview();}
function haltDataSync(){if(adminPanel){adminPanel.classList.remove('active');adminPanel.setAttribute('aria-hidden','true');}}
async function gateCheck(){if(isAdminUnlocked()){initDataSync();return true;}
const entered=prompt('Enter access code');if(entered===null)return false;const ok=String(entered).trim()===decodeAdminSecret();if(ok){setAdminUnlocked();initDataSync();return true;}
alert('Access denied');return false;}
if(adminTrigger){adminTrigger.addEventListener('click',async(e)=>{e.preventDefault();console.log('Logo clicked!');const now=Date.now();adminKnocks=adminKnocks.filter((t)=>now-t<=adminKnockWindowMs);adminKnocks.push(now);if(adminKnockTimer){clearTimeout(adminKnockTimer);adminKnockTimer=null;}
if(adminKnocks.length>=adminKnockCount){adminKnocks=[];await gateCheck();return;}
adminKnockTimer=window.setTimeout(()=>{if(adminKnocks.length===1&&adminLogoLink){const href=adminLogoLink.getAttribute('href')||'#home';if(href.startsWith('#')){const target=document.querySelector(href);if(target){target.scrollIntoView({behavior:'smooth'});}else{window.location.hash=href;}}else{window.location.href=href;}}
adminKnocks=[];adminKnockTimer=null;},adminClickDelayMs);});}
if(isAdminUnlocked()){seedOpsLayer();syncOpsNodes();}
function getLeads(){return readJsonStorage('hailifu_leads',[]);}
function saveLeads(leads){writeJsonStorage('hailifu_leads',leads);}
function addLead(lead){const leads=getLeads();leads.unshift(lead);saveLeads(leads);renderLeads();refreshOverview();}
function renderLeads(){if(!leadsGrid)return;const leads=getLeads();if(leads.length===0){leadsGrid.innerHTML='<div class="lead-card"><strong>No leads yet</strong><small>Leads from the Brilliant Assistant will appear here.</small></div>';return;}
leadsGrid.innerHTML=leads.slice(0,50).map((l)=>{const when=l.createdAt?new Date(l.createdAt).toLocaleString():'';const service=l.serviceLabel||l.service||'Lead';const lines=[l.name?`Name: ${l.name}`:'',l.phone?`Phone: ${l.phone}`:'',l.location?`Location: ${l.location}`:'',l.serviceAnswer?`Details: ${l.serviceAnswer}`:''].filter(Boolean).join('<br>');return`<div class="lead-card"><strong>${service}</strong><small>${when}</small><div style="margin-top:10px; line-height:1.5;">${lines}</div></div>`;}).join('');}
function getProjects(){return readJsonStorage('hailifu_projects',[]);}
function saveProjects(projects){writeJsonStorage('hailifu_projects',projects);}
function renderProjects(){if(!projectsGrid)return;const projects=getProjects();if(projects.length===0){projectsGrid.innerHTML='';return;}
projectsGrid.innerHTML=projects.slice(0,50).map((p)=>{const safeTitle=(p.title||'Project').replace(/</g,'&lt;').replace(/>/g,'&gt;');const thumb=p.mediaType==='video'?`<video src="${p.mediaSrc}" muted></video>`:`<img src="${p.mediaSrc}" alt="${safeTitle}">`;return`<div class="project-thumb" data-admin-project-id="${p.id}">${thumb}<button class="project-delete" type="button" data-delete-project-id="${p.id}">Ã—</button><div style="position:absolute; left:8px; bottom:8px; right:8px; font-size:0.8rem; background: rgba(0,0,0,0.55); padding:6px 8px; border-radius:10px;">${safeTitle}</div></div>`;}).join('');}
function upsertShowcaseProject(project){const showcaseGrid=document.querySelector('.showcase-grid');if(!showcaseGrid)return;const existing=showcaseGrid.querySelector(`[data-generated-project-id="${project.id}"]`);const item=existing||document.createElement('div');item.className='showcase-item animate-on-scroll is-visible';item.dataset.category=project.category||'all';item.dataset.generatedProjectId=project.id;item.dataset.mediaSrc=project.mediaSrc||'';item.dataset.mediaType=project.mediaType||'image';const categoryLabelMap={cctv:'CCTV',electrical:'Electrical',airconditioning:'Air Conditioning',gates:'Automated Gates',fencing:'Electric Fencing',smarthome:'Smart Home'};const iconMap={cctv:'fa-video',electrical:'fa-bolt',airconditioning:'fa-snowflake',gates:'fa-door-open',fencing:'fa-shield-alt',smarthome:'fa-house'};const categoryLabel=categoryLabelMap[project.category]||(project.category||'Project');const iconClass=iconMap[project.category]||'fa-image';item.innerHTML=`
                <div class="project-category">${categoryLabel}</div>
                <div class="showcase-placeholder">
                    <i class="fas ${iconClass}"></i>
                    <span>${project.title || 'Project'}</span>
                </div>
                <div class="showcase-overlay">
                    <h3 class="showcase-title">${project.title || 'Project'}</h3>
                    <p class="showcase-description">${project.description || ''}</p>
                </div>
                <a href="#" class="view-project-btn">
                    <i class="fas fa-eye"></i> View Project
                </a>
            `;if(!existing)showcaseGrid.appendChild(item);item.querySelector('.view-project-btn')?.addEventListener('click',(e)=>{e.preventDefault();openProjectModalFromItem(item);});}
function hydrateShowcaseFromStoredProjects(){const projects=getProjects();projects.forEach((p)=>upsertShowcaseProject(p));}
function setTyping(isTyping){if(!typingIndicator)return;typingIndicator.style.display=isTyping?'flex':'none';}
function scrollChatToBottom(){if(!chatbotMessages)return;chatbotMessages.scrollTop=chatbotMessages.scrollHeight;}
function addMessage(role,html){if(!chatbotMessages)return;const msg=document.createElement('div');msg.className=`message ${role}`;msg.innerHTML=html;if(typingIndicator&&typingIndicator.parentElement===chatbotMessages){chatbotMessages.insertBefore(msg,typingIndicator);}else{chatbotMessages.appendChild(msg);}
scrollChatToBottom();}
function addUserMessage(text){if(!chatbotMessages)return;const msg=document.createElement('div');msg.className='message user';msg.textContent=text;if(typingIndicator&&typingIndicator.parentElement===chatbotMessages){chatbotMessages.insertBefore(msg,typingIndicator);}else{chatbotMessages.appendChild(msg);}
scrollChatToBottom();}
const assistantCatalog={cctv:{label:'CCTV',question:'For CCTV, how many cameras are you looking to install?'},gates:{label:'Gate Automation',question:'For Gate Automation, is it a sliding gate or swing gate?'},electrical:{label:'Electrical Wiring',question:'For Electrical Wiring, is this for a new house wiring or fixing an existing fault?'},airconditioning:{label:'Air Conditioning',question:'For Air Conditioning, is it installation, servicing, or repairs?'},blindcurtain:{label:'Smart Window Solutions',question:'For Smart Window Solutions, do you want motorized blinds, automated curtains, or a full smart window setup?'}};const assistantState={step:'service',serviceKey:'',serviceLabel:'',serviceAnswer:'',name:'',phone:'',location:''};function resetAssistant(){assistantState.step='service';assistantState.serviceKey='';assistantState.serviceLabel='';assistantState.serviceAnswer='';assistantState.name='';assistantState.phone='';assistantState.location='';}
function normalizeService(text){const t=(text||'').toLowerCase();if(t.includes('cctv')||t.includes('camera'))return'cctv';if(t.includes('gate'))return'gates';if(t.includes('electric'))return'electrical';if(t.includes('air conditioning')||t.includes('aircondition')||t.includes('aircon')||t.includes('conditioner')||/\bac\b/.test(t))return'airconditioning';if(t.includes('curtain')||t.includes('blind')||t.includes('smart window')||t.includes('smart windows')||t.includes('window'))return'blindcurtain';return'';}
function normalizePhone(text){const raw=(text||'').trim();const digits=raw.replace(/[^0-9+]/g,'');if(digits.startsWith('+233'))return digits;if(digits.startsWith('233'))return`+${digits}`;if(digits.startsWith('0')&&digits.length===10)return digits;if(digits.length>=9)return digits;return'';}
function showGreeting(){addMessage('bot',`Welcome to Hailifu! I can help you with a quick quote. Are you interested in CCTV, Gate Automation, Electrical Wiring, Air Conditioning, or Smart Window Solutions?
                <div class="brilliant-quick-actions">
                    <button class="brilliant-quick-btn" type="button" data-assistant-service="cctv">CCTV</button>
                    <button class="brilliant-quick-btn" type="button" data-assistant-service="gates">Gate Automation</button>
                    <button class="brilliant-quick-btn" type="button" data-assistant-service="electrical">Electrical Wiring</button>
                    <button class="brilliant-quick-btn" type="button" data-assistant-service="airconditioning">Air Conditioning</button>
                    <button class="brilliant-quick-btn" type="button" data-assistant-service="blindcurtain">Smart Window Solutions</button>
                </div>`);}
function showWhatsAppButton(){const label=assistantState.serviceLabel||'Service';addMessage('bot',`
                <button type="button" class="chatbot-action-btn" data-assistant-whatsapp="1">
                    <i class="fab fa-whatsapp"></i> Chat with Engineer on WhatsApp
                </button>
            `);}
function saveLeadFromState(){addLead({createdAt:new Date().toISOString(),service:assistantState.serviceKey,serviceLabel:assistantState.serviceLabel,serviceAnswer:assistantState.serviceAnswer,name:assistantState.name,phone:assistantState.phone,location:assistantState.location});}
function handleUserInput(text){const value=(text||'').trim();if(!value)return;addUserMessage(value);if(assistantState.step==='service'){const key=normalizeService(value)||value.toLowerCase();const serviceKey=assistantCatalog[key]?key:normalizeService(value);if(!serviceKey||!assistantCatalog[serviceKey]){addMessage('bot','Please choose: CCTV, Gate Automation, Electrical Wiring, Air Conditioning, or Smart Window Solutions.');return;}
assistantState.serviceKey=serviceKey;assistantState.serviceLabel=assistantCatalog[serviceKey].label;bumpServiceInterest(serviceKey);assistantState.step='service_question';addMessage('bot',assistantCatalog[serviceKey].question);return;}
if(assistantState.step==='service_question'){assistantState.serviceAnswer=value;assistantState.step='name';addMessage('bot','Great! Please leave your Name. Our head engineer will call you in less than 30 minutes to finalize the price.');return;}
if(assistantState.step==='name'){assistantState.name=value;assistantState.step='phone';addMessage('bot','Thanks. Please enter your Phone Number (Ghana).');return;}
if(assistantState.step==='phone'){const phone=normalizePhone(value);if(!phone){addMessage('bot','Please enter a valid phone number (e.g., 0550XXXXXXX or +23355XXXXXXX).');return;}
assistantState.phone=phone;assistantState.step='location';addMessage('bot','Finally, what is your Location (Accra or Tema)?');return;}
if(assistantState.step==='location'){assistantState.location=value;saveLeadFromState();addMessage('bot',`Thank you, ${assistantState.name}. We have received your details for ${assistantState.serviceLabel}. Our engineer will call you soon.`);showWhatsAppButton();assistantState.step='done';return;}
if(assistantState.step==='done'){resetAssistant();handleUserInput(value);}}
function sendChat(){if(!chatInput)return;const text=chatInput.value;chatInput.value='';setTyping(false);handleUserInput(text);}
if(chatSendBtn){chatSendBtn.addEventListener('click',sendChat);}
if(chatInput){chatInput.addEventListener('keydown',(e)=>{if(e.key==='Enter'){e.preventDefault();sendChat();}});}
if(chatbotMessages){chatbotMessages.addEventListener('click',(e)=>{const serviceBtn=e.target.closest('[data-assistant-service]');if(serviceBtn){const key=serviceBtn.getAttribute('data-assistant-service');handleUserInput(key);return;}
const waBtn=e.target.closest('[data-assistant-whatsapp]');if(waBtn){const service=assistantState.serviceLabel||'Service';const msg=`Hi Hailifu, I am interested in a quote for ${service}.`;const url=`https://wa.me/233550997270?text=${encodeURIComponent(msg)}`;window.open(url,'_blank');}});}
if(chatbotToggle&&chatbotContainer){chatbotToggle.addEventListener('click',()=>{const opening=!chatbotContainer.classList.contains('active');chatbotContainer.classList.toggle('active');if(opening){setTyping(false);resetAssistant();showGreeting();}});}
if(chatbotClose&&chatbotContainer){chatbotClose.addEventListener('click',()=>{chatbotContainer.classList.remove('active');});}
renderLeads();renderProjects();hydrateShowcaseFromStoredProjects();const popupOverlay=document.getElementById('popupOverlay');const popupClose=document.getElementById('popupClose');const popupQuoteForm=document.getElementById('popupQuoteForm');const popupSuccess=document.getElementById('popupSuccess');const popupService=document.getElementById('popupService');const serviceContext=document.getElementById('serviceContext');function setQuoteService(serviceKey){const labelMap={cctv:'CCTV Installation',electrical:'Electrical Wiring',airconditioning:'Air Conditioning',gates:'Automated Gates',fencing:'Electric Fencing',smarthome:'Smart Home System',blindcurtain:'Smart Window Solutions'};const iconMap={cctv:'fa-video',electrical:'fa-bolt',airconditioning:'fa-snowflake',gates:'fa-door-open',fencing:'fa-shield-alt',smarthome:'fa-house',blindcurtain:'fa-grip-lines-vertical'};if(popupService&&serviceKey){popupService.value=serviceKey;}
if(serviceContext){const label=labelMap[serviceKey]||'Service';const icon=iconMap[serviceKey]||'fa-quote-right';const description=label==='Service'?'Get a free quote for professional services':`Get a free quote for professional ${label.toLowerCase()} services`;serviceContext.innerHTML=`
                    <i class="fas ${icon}"></i>
                    <h3>${label}</h3>
                    <p>${description}</p>
                `;}}
function openQuotePopup(){if(popupOverlay){popupOverlay.classList.add('active');}}
function closeQuotePopup(){if(popupOverlay){popupOverlay.classList.remove('active');}}
if(popupClose){popupClose.addEventListener('click',closeQuotePopup);}
if(heroQuoteBtn){heroQuoteBtn.addEventListener('click',(e)=>{e.preventDefault();setQuoteService(popupService?.value||'');openQuotePopup();});}
document.querySelectorAll('#service-cctv, #service-electrical, #service-airconditioning, #service-gates, #service-fencing, #service-smarthome, #service-blindcurtain').forEach((card)=>{card.addEventListener('click',()=>{const id=card.id||'';const key=id.replace('service-','');bumpServiceInterest(key);setQuoteService(key);openQuotePopup();});});if(popupOverlay){popupOverlay.addEventListener('click',(e)=>{if(e.target===popupOverlay)closeQuotePopup();});}
if(popupQuoteForm){popupQuoteForm.addEventListener('submit',(e)=>{e.preventDefault();const honeypot=String(document.getElementById('popupWebsite')?.value||'').trim();if(honeypot){return;}
const name=document.getElementById('popupName')?.value||'';const phone=document.getElementById('popupPhone')?.value||'';const email=document.getElementById('popupEmail')?.value||'';const location=document.getElementById('popupLocation')?.value||'';const service=document.getElementById('popupService')?.value||'';const serviceLabel=document.getElementById('popupService')?.selectedOptions?.[0]?.textContent||service;const message=document.getElementById('popupMessage')?.value||'';if(service){bumpServiceInterest(service);}
const waMsg=['Hello Hailifu, I want a quote.','',`Service: ${serviceLabel}`,`Name: ${name}`,`Phone: ${phone}`,`Email: ${email}`,`Location: ${location}`,'','Project Details:',message].join('\n');const waUrl=`https://wa.me/233550997270?text=${encodeURIComponent(waMsg)}`;window.open(waUrl,'_blank');if(popupSuccess){popupSuccess.style.display='block';setTimeout(()=>{popupSuccess.style.display='none';closeQuotePopup();},4000);}
popupQuoteForm.reset();});}
if(popupService){popupService.addEventListener('change',()=>{setQuoteService(popupService.value);});}
const markHeroVideoReady=()=>{if(!heroVideo)return;heroVideo.classList.add('is-ready');if(heroFallbackImage)heroFallbackImage.classList.add('is-hidden');};if(heroVideo){heroVideo.addEventListener('load',markHeroVideoReady);}
bumpPageLoads();renderPublicReviews();renderAdminReviews();refreshOverview();const projectModal=document.getElementById('projectModal');const projectModalClose=document.getElementById('projectModalClose');const projectModalTitle=document.getElementById('projectModalTitle');const projectModalCategory=document.getElementById('projectModalCategory');const projectModalDescription=document.getElementById('projectModalDescription');const projectModalMedia=document.getElementById('projectModalMedia');function closeProjectModal(){if(projectModal){projectModal.classList.remove('active');projectModal.setAttribute('aria-hidden','true');}
if(projectModalMedia){projectModalMedia.innerHTML='';}}
function openProjectModalFromItem(item){if(!item||!projectModal)return;const title=item.querySelector('.showcase-title')?.textContent?.trim()||'Project';const description=item.querySelector('.showcase-description')?.textContent?.trim()||'';const category=item.querySelector('.project-category')?.textContent?.trim()||'';if(projectModalTitle)projectModalTitle.textContent=title;if(projectModalCategory)projectModalCategory.textContent=category;if(projectModalDescription)projectModalDescription.textContent=description;if(projectModalMedia){projectModalMedia.innerHTML='';const mediaEl=item.querySelector('img, video');if(mediaEl){const clone=mediaEl.cloneNode(true);if(clone.tagName&&clone.tagName.toLowerCase()==='video'){clone.controls=true;clone.autoplay=false;clone.muted=false;}
projectModalMedia.appendChild(clone);}else if(item.dataset&&item.dataset.mediaSrc){const type=item.dataset.mediaType||'image';if(type==='video'){const video=document.createElement('video');video.src=item.dataset.mediaSrc;video.controls=true;projectModalMedia.appendChild(video);}else{const img=document.createElement('img');img.src=item.dataset.mediaSrc;img.alt=title;projectModalMedia.appendChild(img);}}else{const placeholder=document.createElement('div');placeholder.style.padding='22px';placeholder.style.textAlign='center';placeholder.style.color='rgba(255, 255, 255, 0.75)';placeholder.innerHTML='<div style="font-size:2.2rem; margin-bottom:10px; color: var(--orange);"><i class="fas fa-image"></i></div><div>Project preview will appear here once media is added.</div>';projectModalMedia.appendChild(placeholder);}}
projectModal.classList.add('active');projectModal.setAttribute('aria-hidden','false');}
if(projectModalClose){projectModalClose.addEventListener('click',closeProjectModal);}
if(projectModal){projectModal.addEventListener('click',(e)=>{if(e.target===projectModal)closeProjectModal();});}
document.addEventListener('keydown',(e)=>{if(e.key==='Escape'){closeProjectModal();closeQuotePopup();haltDataSync();}});document.querySelectorAll('.view-project-btn').forEach((btn)=>{btn.addEventListener('click',(e)=>{e.preventDefault();const item=btn.closest('.showcase-item');openProjectModalFromItem(item);});});const filterButtons=document.querySelectorAll('.filter-btn');console.log('Filter buttons found:',filterButtons.length);console.log('Showcase items found:',document.querySelectorAll('.showcase-item').length);filterButtons.forEach(button=>{button.addEventListener('click',function(){console.log('Filter button clicked:',this.dataset.filter);console.log('Button before:',this.className);filterButtons.forEach(btn=>{console.log('Removing active from:',btn.className);btn.classList.remove('active');});this.classList.add('active');console.log('Button after:',this.className);const filterValue=this.dataset.filter;console.log('Filter value:',filterValue);document.querySelectorAll('.showcase-item').forEach(item=>{const category=item.dataset.category;console.log('Checking item:',category,'against filter:',filterValue);if(filterValue==='all'||category===filterValue){item.classList.remove('is-hidden');item.classList.add('is-visible');}else{item.classList.add('is-hidden');item.classList.remove('is-visible');}});});});document.querySelectorAll('.showcase-item').forEach(item=>item.classList.add('is-visible'));const scrollElements=document.querySelectorAll('.animate-on-scroll');if(scrollElements.length>0){if('IntersectionObserver'in window){const scrollObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){entry.target.classList.add('animated');observer.unobserve(entry.target);}});},{threshold:0.2});scrollElements.forEach(element=>scrollObserver.observe(element));}else{scrollElements.forEach(element=>element.classList.add('animated'));}}
const reviewToggleButtons=document.querySelectorAll('[data-review-toggle]');const reviewPanels=document.querySelectorAll('[data-review-panel]');reviewToggleButtons.forEach(button=>{button.addEventListener('click',()=>{const targetPanel=button.dataset.reviewToggle;reviewToggleButtons.forEach(btn=>btn.classList.remove('active'));button.classList.add('active');reviewPanels.forEach(panel=>{if(panel.dataset.reviewPanel===targetPanel){panel.classList.remove('is-hidden');}else{panel.classList.add('is-hidden');}});});});const interactiveRating=document.getElementById('interactiveRating');const ratingValue=document.getElementById('ratingValue');const stars=interactiveRating?interactiveRating.querySelectorAll('i'):[];let selectedRating=0;function updateStars(rating){stars.forEach((star,index)=>{if(index<rating){star.classList.add('active');star.classList.remove('hover');}else{star.classList.remove('active');star.classList.remove('hover');}});}
function updateStarsHover(rating){stars.forEach((star,index)=>{if(index<rating){star.classList.add('hover');}else{star.classList.remove('hover');}});}
console.log('Interactive rating found:',interactiveRating);console.log('Stars found:',stars.length);if(interactiveRating&&stars.length>0){stars.forEach((star,index)=>{star.addEventListener('click',function(){selectedRating=parseInt(this.dataset.rating);ratingValue.value=selectedRating;updateStars(selectedRating);console.log('Star clicked:',selectedRating);});star.addEventListener('mouseenter',function(){const hoverRating=parseInt(this.dataset.rating);updateStarsHover(hoverRating);});});interactiveRating.addEventListener('mouseleave',function(){updateStars(selectedRating);});}
function submitInteractiveReview(){const name=document.getElementById('leaveReviewerName').value;const rating=document.getElementById('ratingValue').value;const comment=document.getElementById('leaveReviewComment').value;console.log(' Review submitted:',{name:name,rating:rating,comment:comment});if(!name||!rating||!comment){alert('Please fill in all fields and select a rating');return;}
const form=document.querySelector('.leave-review-form');const thankYou=document.getElementById('reviewThankYou');if(form&&thankYou){form.style.display='none';thankYou.style.display='block';setTimeout(()=>{form.style.display='block';thankYou.style.display='none';document.getElementById('leaveReviewerName').value='';document.getElementById('ratingValue').value='0';document.getElementById('leaveReviewComment').value='';updateStars(0);},3000);}}
document.addEventListener('DOMContentLoaded',()=>{console.log('DOM fully loaded - All systems ready');const elements={'Brilliant Chat Button':document.getElementById('brilliantChatBtn'),'Brilliant Chat Window':document.getElementById('brilliantChatWindow'),'Sliders':document.querySelectorAll('.slider')};Object.entries(elements).forEach(([name,element])=>{if(element&&(element.length>0||element)){console.log(`[OK] ${name}: Found`);}else{console.error(`[MISSING] ${name}: Not found`);}});});console.log(' Script initialization complete');